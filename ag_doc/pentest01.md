# Penetration Test Report - Tempolendana (Lendana PMI)
**Code Audit Date**: 2026-01-13
**Auditor**: Antigravity (Security Analysis Mode)
**Standard**: OWASP Top 10:2021

## 1. Executive Summary
Audit keamanan ini difokuskan pada codebase Tempolendana untuk mengidentifikasi celah keamanan kritis berdasarkan standar OWASP Top 10. Ditemukan beberapa temuan kritis terkait kebocoran data pribadi (PII) dan otorisasi yang lemah.

---

## 2. Temuan Utama (OWASP Top 10)

### A01:2021 - Broken Access Control
*   **Temuan 1.1: Kebocoran Data Antar Bank (High)**
    *   **Deskripsi**: Kebijakan RLS (Row Level Security) pada tabel `loan_applications` untuk role `bank_staff` hanya memeriksa apakah user memiliki role tersebut, tanpa memverifikasi keterkaitan user dengan Bank/Cabang tertentu.
    *   **Risiko**: Staf Bank A dapat melihat dan mengubah aplikasi pinjaman yang seharusnya hanya bisa diakses oleh Staf Bank B.
    *   **Lokasi**: `supabase/migrations/00000000000000_full_production_schema.sql` (Line 896).

*   **Temuan 1.2: Izin Penghapusan Data Massal (Medium)**
    *   **Deskripsi**: Fungsi `deleteAllLoanData` dalam `src/lib/supabase.ts` tersedia di sisi klien. Meskipun RLS mungkin membatasinya, eksposur fungsi ini meningkatkan risiko serangan destruktif jika terjadi miskonfigurasi API Key.

### A02:2021 - Cryptographic Failures
*   **Temuan 2.1: Data PII Tidak Terenkripsi (Low)**
    *   **Deskripsi**: Kolom sensitif seperti `nik_ktp` disimpan dalam bentuk teks biasa (plain text).
    *   **Rekomendasi**: Gunakan enkripsi tingkat kolom menggunakan ekstensi `pgcrypto` untuk data sangat sensitif.

### A04:2021 - Insecure Design
*   **Temuan 4.1: Public Storage Bucket untuk Dokumen Sensitif (CRITICAL)**
    *   **Deskripsi**: Bucket `documents` yang menyimpan KTP, Selfie, dan Paspor dikonfigurasi sebagai `public = true` dengan kebijakan akses yang mengizinkan semua orang (`true`) untuk melakukan `SELECT`.
    *   **Risiko**: Siapapun yang memiliki URL file atau mampu menebak pola nama file dapat mengakses dokumen identitas PMI tanpa autentikasi.
    *   **Lokasi**: `supabase/migrations/20240322000007_create_storage_bucket.sql` (Line 5 & 10).

### A05:2021 - Security Misconfiguration
*   **Temuan 5.1: Default Environment Variables (Low)**
    *   **Deskripsi**: Terdapat fallback URL dan Anon Key di dalam kode `src/lib/supabase.ts`.
    *   **Risiko**: Jika variabel lingkungan gagal dipetakan di server produksi, aplikasi akan mencoba tersambung ke default dummy yang mungkin membingungkan atau mengekspos endpoint pengembang.

---

## 3. Rekomendasi Perbaikan (Remediation)

1.  **Segera ubah konfigurasi Storage Bucket**: Set `public = false` pada bucket `documents` dan perbarui RLS policy agar hanya pemilik data atau staf yang berwenang yang dapat melihat file.
2.  **Perketat RLS Policy**: Tambahkan validasi ID Bank/Cabang pada setiap kueri `bank_staff`. Contoh:
    ```sql
    CREATE POLICY "Bank staff view assigned only" ON loan_applications
    FOR SELECT USING (
      EXISTS (
        SELECT 1 FROM bank_staff bs 
        JOIN branch_applications ba ON ba.branch_id = bs.branch_id
        WHERE bs.user_id = auth.uid() AND ba.loan_application_id = id
      )
    );
    ```
3.  **Audit API Keys**: Pastikan `VITE_SUPABASE_ANON_KEY` tidak memiliki hak *service_role*.

---
*Laporan ini dihasilkan oleh Antigravity untuk tujuan edukasi dan perbaikan keamanan internal.*
